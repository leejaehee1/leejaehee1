금일은 어제 진도를 모두 못 나간 상황이라 어제 진도에 맞게 실습위주의 수업을 진행함

오전 수업 내용
```
t2.medium 선택
wasserver 에 git 설치, npm 설치, git clone, pm2 설치, nginx(해보고)

sudo yum update
sudo yum install git -y
sudo yum install nodejs -y
npm -v
node -v
mkdir projects
cd projects

# 각자 완성한 nestjs 최종 소스
git clone https://github.com/wapj/jsbackend.git
ch13 -> nest-chat

npm install pm2 -g
npm run build
vi src/main.ts => ‘0.0.0.0’
npm run build

pm2 start
pm2 logs
pm2 list

ecosystem.config.js
- exec_mode : “fork”,
- instances: 1,
! pm2 delete 하고 해야 깔끔하다.

배포 요청 받았다.
git pull
pm2 restart ecosystem.config.js
pm2 logs

- 실습 문제
Nginx 설치하고, conf 바꿔주고, 보안 그룹 확인(구글링/gpt 써서 해결할것, static -> proxy)

공유한 notion 보면서 https://www.notion.so/2409c8fe565b80b69a0cd3d72cffbb47?source=copy_link
=> # 스태틱 설정 부분은 pm2 start 로 대체되었기에 conf 의 proxy 설정만 해주면 된다.

- rds 연습
Mysql client 설치, 가장 간단한 nodejs 연동 코드 실습
sudo dnf install mariadb105 -y
mysql -h url -uroot -prootroot

mkdir rds_express
cd rds_express
npm init -y
npm i express mysql2
vi server.js

Port 변경 : 3001 , pm2 에서 이미 3000 번 실행중
```

# 📚 교육 교안: 로드 밸런서 준비하기

## 1. 로드 밸런서란?

* **로드 밸런서(Load Balancer)**:

  * 여러 서버(웹 서버, 앱 서버 등)에 트래픽을 자동으로 분산시키는 장치/서비스
  * 특정 서버 과부하 방지 → 안정성과 가용성 향상
  * 서버 장애 발생 시 헬스 체크를 통해 자동으로 트래픽을 다른 서버로 우회

👉 예시:

* 고객이 동시에 웹 서비스 접속 시, 로드 밸런서가 여러 서버로 트래픽을 나누어 처리

---

## 2. AWS 제공 로드 밸런서 유형

* **Application Load Balancer (ALB)**

  * OSI 7계층 (L7)
  * HTTP/HTTPS 요청 기반 라우팅
  * 경로 기반, 호스트 기반 라우팅 가능
* **Network Load Balancer (NLB)**

  * OSI 4계층 (L4)
  * 초고성능, 초저지연 네트워크 트래픽 처리
  * TCP/UDP 기반 애플리케이션 적합
* **Gateway Load Balancer (GWLB)**

  * 네트워크 보안/감시 장비와 함께 사용
  * 트래픽을 가상 어플라이언스에 전달

👉 학습에서는 가장 일반적인 **ALB (Application Load Balancer)** 활용

---

## 3. 대상 그룹 기반 요청 라우팅

* **대상 그룹(Target Group)**

  * 로드 밸런서가 트래픽을 분산시킬 대상(EC2, ECS, Lambda 등)을 묶은 그룹
  * 헬스 체크(Health Check)로 정상 동작하는 인스턴스에만 트래픽 전달
* **라우팅 방식**

  * **라운드 로빈(Round Robin)**: 순차적으로 분산
  * **경로 기반 라우팅**: URL 경로(`/api/*`, `/images/*`)에 따라 분배
  * **호스트 기반 라우팅**: 도메인 이름(`api.example.com`)에 따라 분배

---

## 4. 생성 과정 및 구성

### 4-1. ALB 생성 절차

1. **로드 밸런서 생성**

   * ALB 선택
   * 리스너(Listener): 80(HTTP), 필요시 443(HTTPS)
2. **네트워크 설정**

   * VPC 선택
   * 퍼블릭 서브넷 2개 이상 지정 (멀티 AZ)
3. **보안 그룹 설정**

   * 인바운드: 80/443 허용
   * 아웃바운드: 모든 트래픽 허용 (기본)
4. **대상 그룹 생성**

   * EC2 인스턴스 2대 이상 등록
   * 헬스 체크 경로: `/`
5. **ALB와 대상 그룹 연결**

   * 리스너 규칙에서 트래픽을 대상 그룹으로 전달

---

## 5. HTTP 요청과 라우팅 확인 실습

1. **사전 준비**

   * 퍼블릭 서브넷에 웹 서버 EC2 2대 구축
   * 각 웹 서버에 서로 다른 index.html 설정

     * 서버1: `<h1>Hello from Server 1</h1>`
     * 서버2: `<h1>Hello from Server 2</h1>`
2. **로드 밸런서 DNS 주소 확인**

   * 생성 완료 후 ALB의 DNS 이름 복사
   * 예: `http://my-alb-123456789.ap-northeast-2.elb.amazonaws.com`
3. **브라우저 접속 테스트**

   * 새로고침 시마다 서버1, 서버2 페이지 번갈아 표시 → 라운드 로빈 분산 확인
4. **헬스 체크 테스트**

   * 서버1 강제 중단 → ALB가 서버2로만 트래픽 분배되는지 확인

---

## 📌 요약 & 정리

* 로드 밸런서는 서비스 트래픽을 여러 서버에 분산시켜 **고가용성, 확장성**을 제공
* AWS는 ALB, NLB, GWLB 세 가지 유형 제공 → 웹 서비스에는 ALB가 일반적
* 대상 그룹을 기반으로 트래픽을 전달하고, 헬스 체크로 장애 서버는 자동 제외
* 실습을 통해 라운드 로빈 방식과 헬스 체크 동작을 직접 확인 가능




# 📚 교육 교안: 데이터베이스 서버 준비하기

## 1. 데이터베이스 서버 개념

* **데이터베이스 서버(DB Server)**

  * 데이터를 체계적으로 저장, 관리, 조회하는 서버
  * 웹/앱 서비스의 핵심 구성 요소 (사용자 계정, 주문 내역, 게시글 등 저장)
* **직접 설치 방식 vs 관리형 서비스**

  * 직접 설치: EC2에 MySQL/PostgreSQL 설치 및 관리
  * 관리형 서비스: AWS RDS 사용 → 백업, 패치, 장애 조치 자동화

👉 학습에서는 **AWS RDS**를 활용하여 데이터베이스 서버 준비

---

## 2. RDS 개요

* **RDS (Relational Database Service)**

  * AWS가 제공하는 관리형 관계형 DB 서비스
  * 지원 엔진: MySQL, PostgreSQL, MariaDB, Oracle, SQL Server, Amazon Aurora
* **특징**

  * 자동 백업 & 스냅샷
  * Multi-AZ 배포(장애 조치)
  * 성능 모니터링 (CloudWatch)
  * 확장성 (읽기 전용 리플리카 지원)

---

## 3. 파라미터 그룹 및 옵션 그룹 생성

* **파라미터 그룹(Parameter Group)**

  * DB 엔진 동작 방식 정의 (예: max\_connections, 캐시 크기)
  * 사용자 정의 설정을 적용하고, 인스턴스에 연결 가능
* **옵션 그룹(Option Group)**

  * 특정 DB 엔진 기능 활성화 (예: Oracle TDE, SQL Server Transparent Data Encryption 등)
  * 고급 기능이 필요할 때 사용

👉 실습:

* 콘솔에서 **Parameter Group** 생성 후 MySQL의 `character_set_server = utf8mb4` 설정
* 새 그룹을 RDS 인스턴스에 적용

---

## 4. 서브넷 그룹 구성

* **DB 서브넷 그룹(DB Subnet Group)**

  * RDS 인스턴스를 배치할 **프라이빗 서브넷 모음**
  * 최소 2개 이상의 가용 영역(AZ)에 서브넷 포함해야 고가용성 지원
* **설계 예시**

  * `10.0.2.0/24` (AZ a)
  * `10.0.3.0/24` (AZ b)

👉 실습:

* VPC 내에서 프라이빗 서브넷 2개 선택 → DB Subnet Group 생성

---

## 5. RDS 인스턴스 생성 및 동작 확인

### 5-1. 생성 절차

1. 콘솔 → RDS → 데이터베이스 생성
2. 엔진 선택: MySQL (학습용)
3. 템플릿: Free tier (학습)
4. 자격 증명 설정: Master username / password
5. VPC, DB 서브넷 그룹 선택
6. 퍼블릭 액세스: **비활성화 (보안상)**
7. 보안 그룹: 웹 서버에서 DB 접근 가능하도록 3306 포트 허용

### 5-2. 동작 확인

* 점프 서버 또는 웹 서버에서 접속 테스트

  ```bash
  mysql -h <RDS 엔드포인트> -u <username> -p
  ```
* DB 연결 성공 시 → `show databases;` 실행해 기본 DB 확인

---

## 📌 요약 & 정리

* 데이터베이스 서버는 서비스 핵심 데이터를 관리하는 역할
* RDS는 AWS 관리형 서비스로 백업, 보안, 장애 조치를 자동화
* 파라미터 그룹/옵션 그룹으로 DB 동작 방식을 제어 가능
* DB Subnet Group은 고가용성을 위해 최소 2개 AZ 포함 필요
* 실습을 통해 MySQL RDS 인스턴스를 생성하고 접속 확인

---
